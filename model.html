<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blue Shark Tracking - Bio-tag design</title>
	<!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🦈</text></svg>">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', Arial, sans-serif;
            font-weight: 700;
            background: #f5f5f5;
            color: #333;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }
        
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header.hidden {
            transform: translateY(-100%);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header-title {
            flex: 1;
        }

        .header-title h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .header-title p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            gap: 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 4px;
        }

        .nav-tab {
            padding: 10px 20px;
            text-decoration: none;
            color: rgba(255, 255, 255, 0.7);
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .nav-tab:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-tab.active {
            color: white;
            background: #3498db;
        }
        
        .hero-section {
            height: calc(100vh - 80px);
            display: flex;
            position: relative;
            background: #f5f5f5;
        }
        
        .hero-viewer {
            width: 60%;
            position: relative;
        }
        
        .hero-message {
            width: 40%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 3rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .hero-message h2 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            line-height: 1.2;
        }
        
        .hero-message p {
            font-size: 1.2rem;
            line-height: 1.8;
            margin-bottom: 2rem;
        }
        
        .scroll-button {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: #3498db;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .scroll-button:hover {
            background: #2980b9;
            transform: translateX(-50%) translateY(-5px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.6);
        }
        
        .detail-section {
            min-height: 100vh;
            background: white;
            padding: 6rem 2rem 4rem 2rem;
            color: #333;
        }
        
        .detail-content {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .detail-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .detail-header h2 {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #2c3e50;
        }
        
        .detail-header p {
            font-size: 1.3rem;
            opacity: 0.9;
        }
        
        .detail-viewer-container {
            display: flex;
            gap: 3rem;
            margin-bottom: 3rem;
            align-items: flex-start;
        }
        
        .detail-viewer {
            flex: 1;
            position: relative;
            height: 600px;
            background: #f8f9fa;
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }
        
        .detail-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s ease-out;
        }
        
        .detail-info.slide-in {
            opacity: 1;
            transform: translateY(0);
        }
        
        .detail-info h3 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            color: #2c3e50;
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
        }
        
        .detail-info p {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 1.5rem;
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
            text-align: center;
            max-width: 600px;
        }
        
        .detail-info ul {
            list-style: none;
            padding: 0;
        }
        
        .detail-info li {
            padding: 0.8rem 0;
            padding-left: 2rem;
            position: relative;
            font-size: 1.05rem;
            line-height: 1.6;
        }
        
        .detail-info li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #64b5f6;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .tag-image {
            width: 100%;
            max-width: 600px;
            margin: 0 auto 2rem auto;
            display: block;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .tag-hero-section {
            background: white;
            padding: 3rem 2rem;
            margin: -6rem -2rem 0 -2rem;
            padding-top: 10rem;
            padding-bottom: 2rem;
        }
        
        .component-hero-section {
            background: white;
            padding: 2rem 2rem;
            margin: 0 -2rem;
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        
        .component-hero-section:last-of-type {
            padding-bottom: 2rem;
        }
        
        .tag-image-container {
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: flex-start;
            gap: 2rem;
            flex-direction: row;
        }
        
        /* Reverse layout for alternating sections */
        .tag-image-container.reverse {
            flex-direction: row-reverse !important;
        }
        
        /* Debug: Add background colors to verify layout */
        .tag-image-container {
            background: rgba(52, 152, 219, 0.05);
            padding: 1rem;
            border-radius: 10px;
        }
        
        .tag-image-container.reverse {
            background: rgba(231, 76, 60, 0.05);
        }
        
        .tag-hero-image {
            width: 60%;
            max-width: 700px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            object-fit: contain;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .tag-hero-image:hover {
            transform: scale(1.1) translateY(-10px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.25);
            z-index: 10;
        }
        
        .tag-title-overlay {
            flex: 1;
            text-align: center;
            padding: 1rem 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transform: translateX(-50px);
            transition: all 0.8s ease-out;
        }
        
        /* Slide in animation when visible */
        .tag-title-overlay.slide-in {
            opacity: 1;
            transform: translateX(0);
        }
        
        /* Reverse slide direction for reversed sections */
        .tag-image-container.reverse .tag-title-overlay {
            transform: translateX(50px);
        }
        
        .tag-image-container.reverse .tag-title-overlay.slide-in {
            transform: translateX(0);
        }
        
        .tag-title-overlay h2 {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 1rem;
            line-height: 1.3;
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
            text-align: center;
        }
        
        .tag-title-overlay p {
            font-size: 1.1rem;
            color: #555;
            font-style: normal;
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
            text-align: center;
            max-width: 400px;
        }
        
        .component-section {
            margin-top: 3rem;
        }
        
        .component-section h3 {
            font-size: 2rem;
            margin-bottom: 2rem;
            text-align: center;
            color: #2c3e50;
        }
        
        .component-item {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .component-item h4 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }
        
        .component-item h5 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            font-style: italic;
            opacity: 0.9;
        }
        
        .component-item p {
            font-size: 1.05rem;
            line-height: 1.8;
            margin-bottom: 0.5rem;
        }
        
        .controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .controls h3 {
            margin-bottom: 10px;
            font-size: 1rem;
            color: #2c3e50;
        }
        
        .control-group {
            margin-bottom: 10px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.8rem;
        }
        
        .control-group input[type="range"] {
            width: 150px;
        }
        
        .control-group button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 5px;
            font-size: 0.8rem;
        }
        
        .control-group button:hover {
            background: #2980b9;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 200;
            color: #333;
        }
        
        .loading.hidden {
            display: none;
        }
        
        .spinner {
            border: 4px solid rgba(52, 152, 219, 0.3);
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #heroViewer {
            width: 100%;
            height: 100%;
            cursor: grab;
        }
        
        #heroViewer:active {
            cursor: grabbing;
        }
        
        #detailViewer {
            width: 100%;
            height: 100%;
            cursor: grab;
        }
        
        #detailViewer:active {
            cursor: grabbing;
        }
        
        .error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(231, 76, 60, 0.9);
            padding: 20px;
            border-radius: 10px;
            z-index: 200;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="header-title">
                <h1>Blue Shark Tracking Project</h1>
                <p>Interactive 3D model of bio-tag</p>
            </div>
            <nav class="nav-tabs">
                <a href="mission.html" class="nav-tab">Our Mission</a>
                <a href="index.html" class="nav-tab">Explore</a>
                <a href="predict.html" class="nav-tab">Prediction</a>
                <a href="model.html" class="nav-tab active">Bio-tag</a>
				<a href="globe.html" class="nav-tab">3D Tracking</a>
            </nav>
        </div>
    </div>
    
    <!-- Hero Section with Tag Model -->
    <section class="hero-section">
        <div class="hero-viewer">
            <div class="loading" id="heroLoading">
                <div class="spinner"></div>
                <p>Loading 3D model...</p>
            </div>
            
            <div class="controls" id="heroControls">
                <h3>Controls</h3>
                <div class="control-group">
                    <label>Zoom:</label>
                    <input type="range" id="heroZoomSlider" min="0.5" max="5" step="0.1" value="1">
                </div>
                <div class="control-group">
                    <label>Rotation Speed:</label>
                    <input type="range" id="heroSpeedSlider" min="0" max="0.05" step="0.005" value="0.01">
                </div>
                <div class="control-group">
                    <button id="heroResetBtn">Reset View</button>
                    <button id="heroToggleRotation" style="background: #c0392b;">Stop Rotate</button>
                </div>
            </div>
            
            <div id="heroViewer"></div>
        </div>
        
        <div class="hero-message">
            <h2>Bio-Tag</h2>
            <p>Curious how sharks are located on a 2D map, or tracked even 1000 miles away? This is all done by using bio-tag!</p>
            <p>The model on the left is our innovative tag. Scroll down to see how our design is 20x more durable and transmits data 10x faster than the current ones.</p>
            <!-- <p style="font-size: 1.4rem; font-weight: 600; color: #ffd700;">See our Bio-tag design!</p> -->
        </div>
        
        <button class="scroll-button" id="scrollButton">See more about our tag ↓</button>
    </section>
    
    <!-- Detail Section with Shark Remora Model -->
    <section class="detail-section" id="detailSection">
        <div class="detail-content">
            <!-- Tag Image Hero Section -->
            <div class="tag-hero-section">
                <div class="tag-image-container">
                    <img src="./images/tag.jpg" alt="Self-Powered Edge AI Shark Tag Pro" class="tag-hero-image">
                    <div class="tag-title-overlay">
                        <h2>Self-Powered <i>x</i> Edge AI Shark Tag Pro</h2>
                        <p>Advanced tracking technology inspired by nature</p>
                    </div>
                </div>
            </div>
            
            <!-- Fiber Image Section -->
            <div class="component-hero-section">
                <div class="tag-image-container reverse">
                    <img src="./images/fiber.jpg" alt="Energy Harvester" class="tag-hero-image">
                    <div class="tag-title-overlay">
                        <h2>Energy Harvester</h2>
                        <p>Turning a shark's swim into power.</p>
                    </div>
                </div>
            </div>
            
            <!-- Prey Sensor Image Section -->
            <div class="component-hero-section">
                <div class="tag-image-container">
                    <img src="./images/prey.jpg" alt="Prey Sensor" class="tag-hero-image">
                    <div class="tag-title-overlay">
                        <h2>Prey Sensor</h2>
                        <p>Revealing the Hunt</p>
                    </div>
                </div>
            </div>
            
            <!-- Suction Disc Image Section -->
            <div class="component-hero-section">
                <div class="tag-image-container reverse">
                    <img src="./images/suction.jpg" alt="Suction Disc" class="tag-hero-image">
                    <div class="tag-title-overlay">
                        <h2>Suction Disc</h2>
                        <p>A Gentle Hold to the Shark -- Non-invasive Mount</p>
                    </div>
                </div>
            </div>

                        
            <div class="detail-viewer-container">
                <div class="detail-viewer">
                    <div class="loading" id="detailLoading">
                        <div class="spinner"></div>
                        <p>Loading 3D model...</p>
                    </div>
                    
                    <div class="controls" id="detailControls">
                        <h3>Controls</h3>
                        <div class="control-group">
                            <label>Zoom:</label>
                            <input type="range" id="detailZoomSlider" min="0.5" max="5" step="0.1" value="1">
                        </div>
                        <div class="control-group">
                            <label>Rotation Speed:</label>
                            <input type="range" id="detailSpeedSlider" min="0" max="0.05" step="0.005" value="0.01">
                        </div>
                        <div class="control-group">
                            <button id="detailResetBtn">Reset View</button>
                            <button id="detailToggleRotation" style="background: #c0392b;">Stop Rotate</button>
                        </div>
                        <div class="control-group">
                            <button id="focusBioTagBtn" style="background: #27ae60;">Focus on Bio-Tag</button>
                        </div>
                    </div>
                    
                    <div id="detailViewer"></div>
                </div>
                
                <div class="detail-info">
                    <h3>About the Remora</h3>
                    <p>The remora, often called the "hitchhiker" of the ocean, can grow up to 90 centimeters in length. With its remarkable suction disc, specially evolved from a dorsal fin, it clings effortlessly to the mighty bodies of sharks. More than one may accompany a single host, fastening themselves securely as their vessel glides across the vast blue. Together, shark and remora traverse thousands of kilometers across the open ocean — a partnership forged in the deep currents of survival and opportunity.</p>
                    <p>By borrowing nature’s elegant solution, our tag rides with the shark comfortably and unobtrusively, turning a biological partnership into a durable engineering approach.</p>
                </div>
            </div>
            
            <!-- Key Features Section (moved below) -->
            <div class="component-section" style="margin-top: 3rem;">
                <h3>Key Features</h3>
                <div style="max-width: 1200px; margin: 0 auto;">
                    <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem;">Unlike traditional shark tags, which often last no longer than a year, this biomimetic tag draws its energy directly from the motion of the shark — powered by advanced piezoelectric fibers. As long as the shark lives and swims, the tag endures, extending observation far beyond conventional limits.</p>
                    <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem;">Traditional satellite tags struggle to return data in real time. But this new generation of shark tag does more. It can sense what these ocean giants are eating, and transmit that knowledge instantly back to researchers. For the first time, we gain not just glimpses, but a living, continuous stream of intelligence — enabling the creation of predictive models of marine behavior.</p>
                </div>
            </div>
            
            <div class="component-section">
                <h3>Key Components Overview</h3>
                
                <div class="component-item">
                    <h4>1. Energy Harvester</h4>
                    <h5>Motion to Energy -- Turning a shark's swim into power.</h5>
                    <p>At the rear of the tag, slender piezoelectric fibers bend with the flow—like a remora's tail flexing in the current. Each tiny vibration becomes electricity. Unlike traditional tags that fade within a year, this biomimetic design feeds on motion: as long as the shark swims, the tag keeps working, extending our watch far beyond old limits.</p>
                    <p>In tests on live fish, the harvester produced ~80 μW, enough to power up light a blue LED—proof that life in motion can power science.</p>
                    <p>In comparison with battery tags, this approach can support longer studies and more data over time.</p>
                </div>
                
                <div class="component-item">
                    <h4>2. Suction Disc</h4>
                    <h5>A Gentle Hold to the Shark -- Non-invasive Mount</h5>
                    <p>Secure attachment, minimal drag, no piercing.</p>
                    <p>Inspired by remoras and modern suction-cup wildlife tags, the mount grips the skin without injury. It rides quietly with the animal across long distances, staying low-profile to reduce drag—built to endure real ocean travel while keeping the host unharmed.</p>
                </div>
                
                <div class="component-item">
                    <h4>3. Prey Sensor</h4>
                    <h5>Revealing the Hunt</h5>
                    <p>Sensors wake when a predator moves.</p>
                    <p>A small network listens for the signs of feeding and switches on only when it matters:</p>
                    <ul style="margin-left: 1.5rem; margin-top: 1rem;">
                        <li style="margin-bottom: 0.5rem;"><strong>IMU / accelerometer:</strong> bursts of speed, rolls, lunges.</li>
                        <li style="margin-bottom: 0.5rem;"><strong>Pressure sensor:</strong> depth changes before and after the strike.</li>
                        <li style="margin-bottom: 0.5rem;"><strong>Magnetometer:</strong> heading and orientation for sensor fusion.</li>
                        <li style="margin-bottom: 0.5rem;"><strong>Hydrophone (passive acoustics):</strong> the scatter of prey, jaw impacts, tearing sounds, social calls.</li>
                    </ul>
                    <p style="margin-top: 1rem;">When these cues align, a miniature camera activates—capturing short, high-value clips around the feeding moment so we can tell what the shark is eating, not just where it swims.</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <script>
        // Scroll button functionality
        document.getElementById('scrollButton').addEventListener('click', function() {
            document.getElementById('detailSection').scrollIntoView({ behavior: 'smooth' });
        });
        
        // Hero viewer (tag.glb)
        let heroScene, heroCamera, heroRenderer, heroControls, heroModel;
        let heroAutoRotate = true;
        let heroRotationSpeed = 0.01;

        // Detail viewer (shark.glb)
        let detailScene, detailCamera, detailRenderer, detailControls, detailModel;
        let detailAutoRotate = true;
        let detailRotationSpeed = 0.01;
        let tagComponent = null; // Store reference to tag component for glowing effect
        let glowIntensity = 0; // For pulsing glow animation
        
        // Initialize hero viewer
        function initHeroViewer() {
            const container = document.getElementById('heroViewer');
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            heroScene = new THREE.Scene();
            heroScene.background = new THREE.Color(0xf5f5f5);
            
            heroCamera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
            heroCamera.position.set(0, 0, 60);
            
            heroRenderer = new THREE.WebGLRenderer({ antialias: true });
            heroRenderer.setSize(width, height);
            heroRenderer.shadowMap.enabled = true;
            heroRenderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(heroRenderer.domElement);
            
            heroControls = new THREE.OrbitControls(heroCamera, heroRenderer.domElement);
            heroControls.enableDamping = true;
            heroControls.dampingFactor = 0.25;
            heroControls.screenSpacePanning = false;
            heroControls.maxPolarAngle = Math.PI;
            // When the user starts interacting (dragging) we should stop auto-rotation
            heroControls.addEventListener('start', function() {
                heroAutoRotate = false;
                const btn = document.getElementById('heroToggleRotation');
                if (btn) {
                    btn.textContent = 'Auto Rotate';
                    btn.style.background = '#3498db';
                }
            });
            
            const ambientLight = new THREE.AmbientLight(0xffffff, 1.2);
            heroScene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.0);
            directionalLight.position.set(50, 50, 50);
            directionalLight.castShadow = true;
            heroScene.add(directionalLight);
            
            const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight2.position.set(-50, -50, -50);
            heroScene.add(directionalLight2);
            
            const fillLight1 = new THREE.DirectionalLight(0xffffff, 0.5);
            fillLight1.position.set(-50, 50, 50);
            heroScene.add(fillLight1);
            
            const fillLight2 = new THREE.DirectionalLight(0xffffff, 0.5);
            fillLight2.position.set(50, -50, 50);
            heroScene.add(fillLight2);
            
            loadHeroModel();
            setupHeroControls();
            animateHero();
        }
        
        function loadHeroModel() {
            const loader = new THREE.GLTFLoader();
            
            loader.load('models/tag.glb', function(gltf) {
                document.getElementById('heroLoading').classList.add('hidden');
                
                const object = gltf.scene;
                object.traverse(function(child) {
                    if (child instanceof THREE.Mesh) {
                        child.castShadow = true;
                        child.receiveShadow = true;
                    }
                });
                
                // Create a group to hold the model
                const modelGroup = new THREE.Group();
                
                const box = new THREE.Box3().setFromObject(object);
                const center = box.getCenter(new THREE.Vector3());
                
                // Center the object within the group
                object.position.sub(center);
                
                // Add object to group first
                modelGroup.add(object);
                
                // Then scale the entire group
                const size = box.getSize(new THREE.Vector3());
                const maxDim = Math.max(size.x, size.y, size.z);
                const scale = 50 / maxDim;
                modelGroup.scale.setScalar(scale);
                
                // Store reference to the group for rotation
                heroModel = modelGroup;
                
                heroScene.add(modelGroup);
            }, undefined, function(error) {
                console.error('Error loading tag.glb:', error);
            });
        }
        
        function setupHeroControls() {
            document.getElementById('heroZoomSlider').addEventListener('input', function(e) {
                heroCamera.zoom = parseFloat(e.target.value);
                heroCamera.updateProjectionMatrix();
            });
            
            document.getElementById('heroSpeedSlider').addEventListener('input', function(e) {
                heroRotationSpeed = parseFloat(e.target.value);
            });
            
            document.getElementById('heroResetBtn').addEventListener('click', function() {
                heroCamera.position.set(0, 0, 60);
                heroCamera.zoom = 1;
                heroCamera.updateProjectionMatrix();
                heroControls.reset();
                if (heroModel) heroModel.rotation.set(0, 0, 0);
            });
            
            document.getElementById('heroToggleRotation').addEventListener('click', function() {
                heroAutoRotate = !heroAutoRotate;
                this.textContent = heroAutoRotate ? 'Stop Rotate' : 'Auto Rotate';
                this.style.background = heroAutoRotate ? '#c0392b' : '#3498db';
            });
        }
        
        function animateHero() {
            requestAnimationFrame(animateHero);
            
            if (heroAutoRotate && heroModel) {
                heroModel.rotation.y += heroRotationSpeed;
                heroModel.rotation.x += heroRotationSpeed * 0.5;
            }
            
            heroControls.update();
            heroRenderer.render(heroScene, heroCamera);
        }
        
        // Initialize detail viewer
        function initDetailViewer() {
            const container = document.getElementById('detailViewer');
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            detailScene = new THREE.Scene();
            detailScene.background = new THREE.Color(0x1a2332);
            
            detailCamera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
            detailCamera.position.set(0, 0, 60);
            
            detailRenderer = new THREE.WebGLRenderer({ antialias: true });
            detailRenderer.setSize(width, height);
            detailRenderer.shadowMap.enabled = true;
            detailRenderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(detailRenderer.domElement);
            
            detailControls = new THREE.OrbitControls(detailCamera, detailRenderer.domElement);
            detailControls.enableDamping = true;
            detailControls.dampingFactor = 0.25;
            detailControls.screenSpacePanning = false;
            detailControls.maxPolarAngle = Math.PI;
            // Stop detail auto-rotation when the user starts dragging
            detailControls.addEventListener('start', function() {
                detailAutoRotate = false;
                const btn = document.getElementById('detailToggleRotation');
                if (btn) {
                    btn.textContent = 'Auto Rotate';
                    btn.style.background = '#3498db';
                }
            });
            
            const ambientLight = new THREE.AmbientLight(0xffffff, 1.2);
            detailScene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.0);
            directionalLight.position.set(50, 50, 50);
            directionalLight.castShadow = true;
            detailScene.add(directionalLight);
            
            const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight2.position.set(-50, -50, -50);
            detailScene.add(directionalLight2);
            
            const fillLight1 = new THREE.DirectionalLight(0xffffff, 0.5);
            fillLight1.position.set(-50, 50, 50);
            detailScene.add(fillLight1);
            
            const fillLight2 = new THREE.DirectionalLight(0xffffff, 0.5);
            fillLight2.position.set(50, -50, 50);
            detailScene.add(fillLight2);
            
            loadDetailModel();
            setupDetailControls();
            animateDetail();
        }
        
        function loadDetailModel() {
            const loader = new THREE.GLTFLoader();
            
            loader.load('models/shark.glb', function(gltf) {
                document.getElementById('detailLoading').classList.add('hidden');
                
                const object = gltf.scene;
                
                // Find the tag component (組合) and add spotlight
                let foundTagComponent = null;
                object.traverse(function(child) {
                    if (child instanceof THREE.Mesh) {
                        child.castShadow = true;
                        child.receiveShadow = true;
                    }
                    // Look for the tag component by name
                    if (child.name && child.name.includes('組合')) {
                        foundTagComponent = child;
                        tagComponent = child; // Store globally for animation
                        console.log('Found tag component:', child.name);
                        
                        // Make the tag component glow
                        if (child.material) {
                            // Clone material to avoid affecting other objects
                            child.material = child.material.clone();
                            child.material.emissive = new THREE.Color(0x00ffff); // Cyan glow
                            child.material.emissiveIntensity = 0.5;
                        }
                    }
                });
                
                // Create a group to hold the model
                const modelGroup = new THREE.Group();
                
                const box = new THREE.Box3().setFromObject(object);
                const center = box.getCenter(new THREE.Vector3());
                
                // Center the object within the group
                object.position.sub(center);
                
                // Add object to group first
                modelGroup.add(object);
                
                // Then scale the entire group
                const size = box.getSize(new THREE.Vector3());
                const maxDim = Math.max(size.x, size.y, size.z);
                const scale = 50 / maxDim;
                modelGroup.scale.setScalar(scale);
                
                // Add spotlight to highlight the tag component if found
                if (foundTagComponent) {
                    const spotlight = new THREE.SpotLight(0x00ffff, 2); // Cyan spotlight to match glow
                    const tagWorldPos = new THREE.Vector3();
                    foundTagComponent.getWorldPosition(tagWorldPos);
                    
                    // Position spotlight above and slightly to the side of the tag
                    spotlight.position.set(
                        tagWorldPos.x + 20,
                        tagWorldPos.y + 30,
                        tagWorldPos.z + 20
                    );
                    spotlight.target = foundTagComponent;
                    spotlight.angle = Math.PI / 6;
                    spotlight.penumbra = 0.3;
                    spotlight.decay = 2;
                    spotlight.distance = 100;
                    spotlight.castShadow = true;
                    
                    detailScene.add(spotlight);
                    detailScene.add(spotlight.target);
                    
                    // Add point light at tag position for extra glow
                    const pointLight = new THREE.PointLight(0x00ffff, 1, 50);
                    pointLight.position.copy(tagWorldPos);
                    detailScene.add(pointLight);
                    
                    console.log('Spotlight and glow added at tag component');
                } else {
                    console.log('Tag component (組合) not found in model');
                    // Log all object names for debugging
                    object.traverse(function(child) {
                        if (child.name) console.log('Object name:', child.name);
                    });
                }
                
                // Store reference to the group for rotation
                detailModel = modelGroup;
                
                detailScene.add(modelGroup);
            }, undefined, function(error) {
                console.error('Error loading shark.glb:', error);
            });
        }
        
        function setupDetailControls() {
            document.getElementById('detailZoomSlider').addEventListener('input', function(e) {
                detailCamera.zoom = parseFloat(e.target.value);
                detailCamera.updateProjectionMatrix();
            });
            
            document.getElementById('detailSpeedSlider').addEventListener('input', function(e) {
                detailRotationSpeed = parseFloat(e.target.value);
            });
            
            document.getElementById('detailResetBtn').addEventListener('click', function() {
                detailCamera.position.set(0, 0, 60);
                detailCamera.zoom = 1;
                detailCamera.updateProjectionMatrix();
                detailControls.reset();
                if (detailModel) detailModel.rotation.set(0, 0, 0);
            });
            
            document.getElementById('detailToggleRotation').addEventListener('click', function() {
                detailAutoRotate = !detailAutoRotate;
                this.textContent = detailAutoRotate ? 'Stop Rotate' : 'Auto Rotate';
                this.style.background = detailAutoRotate ? '#c0392b' : '#3498db';
            });
            
            document.getElementById('focusBioTagBtn').addEventListener('click', function() {
                if (tagComponent) {
                    // Get the world position of the tag component
                    const tagWorldPos = new THREE.Vector3();
                    tagComponent.getWorldPosition(tagWorldPos);
                    
                    // Calculate camera position to focus on the tag
                    const distance = 30; // Distance from the tag
                    const targetPos = new THREE.Vector3(
                        tagWorldPos.x,
                        tagWorldPos.y,
                        tagWorldPos.z + distance
                    );
                    
                    // Smoothly animate camera to the tag position
                    animateCameraToPosition(targetPos, tagWorldPos);
                    
                    // Stop auto-rotation when focusing
                    detailAutoRotate = false;
                    document.getElementById('detailToggleRotation').textContent = 'Auto Rotate';
                    document.getElementById('detailToggleRotation').style.background = '#3498db';
                    
                    // Zoom in
                    detailCamera.zoom = 2.5;
                    detailCamera.updateProjectionMatrix();
                    document.getElementById('detailZoomSlider').value = 2.5;
                } else {
                    alert('Bio-tag component not found in the model. Please check the console for available component names.');
                }
            });
        }
        
        // Smooth camera animation function
        function animateCameraToPosition(targetPos, lookAtPos) {
            const startPos = detailCamera.position.clone();
            const startLookAt = detailControls.target.clone();
            let progress = 0;
            const duration = 1000; // 1 second animation
            const startTime = Date.now();
            
            function animate() {
                const elapsed = Date.now() - startTime;
                progress = Math.min(elapsed / duration, 1);
                
                // Ease in-out function
                const eased = progress < 0.5 
                    ? 2 * progress * progress 
                    : -1 + (4 - 2 * progress) * progress;
                
                // Interpolate camera position
                detailCamera.position.lerpVectors(startPos, targetPos, eased);
                
                // Interpolate look-at target
                detailControls.target.lerpVectors(startLookAt, lookAtPos, eased);
                detailControls.update();
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            }
            
            animate();
        }
        
        function animateDetail() {
            requestAnimationFrame(animateDetail);
            
            if (detailAutoRotate && detailModel) {
                detailModel.rotation.y += detailRotationSpeed;
                detailModel.rotation.x += detailRotationSpeed * 0.5;
            }
            
            // Pulsing glow effect for tag component
            if (tagComponent && tagComponent.material) {
                glowIntensity += 0.02;
                const pulse = Math.sin(glowIntensity) * 0.3 + 0.5; // Oscillates between 0.2 and 0.8
                tagComponent.material.emissiveIntensity = pulse;
            }
            
            detailControls.update();
            detailRenderer.render(detailScene, detailCamera);
        }
        
        // Handle window resize
        window.addEventListener('resize', function() {
            const heroContainer = document.getElementById('heroViewer');
            const heroWidth = heroContainer.clientWidth;
            const heroHeight = heroContainer.clientHeight;
            heroCamera.aspect = heroWidth / heroHeight;
            heroCamera.updateProjectionMatrix();
            heroRenderer.setSize(heroWidth, heroHeight);
            
            const detailContainer = document.getElementById('detailViewer');
            const detailWidth = detailContainer.clientWidth;
            const detailHeight = detailContainer.clientHeight;
            detailCamera.aspect = detailWidth / detailHeight;
            detailCamera.updateProjectionMatrix();
            detailRenderer.setSize(detailWidth, detailHeight);
        });
        
        // Initialize when page loads
        window.addEventListener('load', function() {
            initHeroViewer();
            initDetailViewer();
            setupScrollAnimations();
        });
        
        // Scroll-triggered slide-in animations
        function setupScrollAnimations() {
            const observerOptions = {
                threshold: 0.2,
                rootMargin: '0px 0px -100px 0px'
            };
            
            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('slide-in');
                    }
                });
            }, observerOptions);
            
            // Observe all text overlays
            document.querySelectorAll('.tag-title-overlay').forEach(el => {
                observer.observe(el);
            });
            
            // Observe detail-info section
            document.querySelectorAll('.detail-info').forEach(el => {
                observer.observe(el);
            });
        }
    </script>
</body>
</html>
